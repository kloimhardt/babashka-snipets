<html>
    <script type="importmap">
     {
         "imports": {
             "squint-cljs": "https://unpkg.com/squint-cljs@0.8.143/index.js",
             "squint-cljs/core.js": "https://unpkg.com/squint-cljs@0.8.143/core.js",
             "squint-cljs/html.js": "https://squint-cljs.github.io/squint/src/squint/html.js"
         }
     }
    </script>

    <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>

    <script type="module">
     import { compileString } from 'squint-cljs';
     import * as squint_core from 'squint-cljs/core.js';
     import * as squint_html from 'squint-cljs/html.js';

     const wset = (k, v) => window[k]=v;
     const cmpStr = s => compileString(s,{"elide-imports": true,"elide-exports": true});

     const c1 = cmpStr('(wset "erg" (doall (map (fn [x] (inc x)) [1 2 3]))) (pr-str #html [:h1 "a"])');

     console.log(c1);
     window.res = eval(c1);
     console.log(window.res);
     window.evalSquint = s => eval(cmpStr(s))
     // erg, res, evalSquint() available in console, all this is async
    </script>

    <h1>Squint Example</h1>
    <h2>open browser console</h2>
    <h3>see also blog/docs/html/emmysquint.html</h3>

    <script>
     Blockly.defineBlocksWithJsonArray([
         {
             "type": "list-h-2",
             "message0": " %1 \u007C %2",
             "args0": [
                 {
                     "type": "input_value",
                     "name": "args-1",
                 },
                 {
                     "type": "input_value",
                     "name": "args-2"
                 }
             ],
             "inputsInline": true,
             "output": null,
             "colour": 70,
             "tooltip": "",
             "helpUrl": ""
         },
         {
             "type": "num",
             "message0": "%1",
             "args0": [
                 {
                     "type": "field_input",
                     "name": "nummer",
                     "text": "0.0"
                 }
             ],
             "output": null,
             "colour": "#A65C81",
             "tooltip": "",
             "helpUrl": ""
         },
         {
             "type": "funs-h-2-inp",
             "message0": "%1 %2",
             "args0": [
                 {
                     "type": "field_input",
                     "name": "kopf",
                     "text": ""
                 },
                 {
                     "type": "input_value",
                     "name": "args-2"
                 }
             ],
             "inputsInline": true,
             "output": null,
             "colour": 270,
             "tooltip": "",
             "helpUrl": ""
         },
         {
             "type": "funs-h-3-inp",
             "message0": "%1 %2 %3",
             "args0": [
                 {
                     "type": "field_input",
                     "name": "kopf",
                     "text": ""
                 },
                 {
                     "type": "input_value",
                     "name": "args-2"
                 },
                 {
                     "type": "input_value",
                     "name": "args-3"
                 }
             ],
             "inputsInline": true,
             "output": null,
             "colour": 140,
             "tooltip": "",
             "helpUrl": ""
         }
     ]);

     var toolbox = {
         "kind": "categoryToolbox",
         "contents": [
             {
                 "kind": "category",
                 "name": ">",
                 "contents": [
                     {"kind": "block", "type": "num"},
                     {"kind": "block", "type": "funs-h-2-inp"},
                     {"kind": "block", "type": "funs-h-3-inp"},
                 ]
     }]}
    </script>

    <div id="blocklyDiv1" style="height: 100%"></div>

    <script>
     var workspace1 = Blockly.inject('blocklyDiv1', {
         "toolbox": toolbox,
         "sounds": false});

     var xs = "<xml><block id=\"funs-h-2-inpid1\" type=\"funs-h-2-inp\"><field name=\"kopf\">a</field><value name=\"args-2\"><block id=\"num2-funs-h-2-inpid1\" type=\"num\"><field name=\"nummer\">1</field></block></value></block></xml>"

     var xs2 = "<xml><block id=\"list-h-2-10-10\" type=\"list-h-2\" x=\"10\" y=\"10\"><value name=\"args-1\"><block id=\"funs-h-2-inp1-list-h-2-10-10\" type=\"funs-h-2-inp\"><field name=\"kopf\">D</field><value name=\"args-2\"><block id=\"funs-h-2-inp2-funs-h-2-inp1-list-h-2-10-10\" type=\"funs-h-2-inp\"><field name=\"kopf\">s_log_base</field><value name=\"args-2\"><block id=\"num2-funs-h-2-inp2-funs-h-2-inp1-list-h-2-10-10\" type=\"num\"><field name=\"nummer\">base</field></block></value></block></value></block></value><value name=\"args-2\"><block id=\"num2-list-h-2-10-10\" type=\"num\"><field name=\"nummer\">x</field></block></value></block></xml>"

     const xmlDom = Blockly.utils.xml.textToDom(xs2)
     Blockly.Xml.clearWorkspaceAndLoadFromXml(xmlDom,workspace1)

    </script>
</html>
